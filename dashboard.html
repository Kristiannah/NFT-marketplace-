<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ArtMintX — Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0d1117;
      --panel:#161b22;
      --muted:#9aa4af;
      --text:#e6e6e6;
      --brand:#00bcd4;
      --brand-2:#0097a7;
      --card:#0f141b;
      --border:#21262d;
      --success:#17c964;
      --danger:#f31260;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    a{color:inherit;text-decoration:none}
    .layout{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
    /* Sidebar */
    .sidebar{background:var(--panel);border-right:1px solid var(--border);position:sticky;top:0;height:100vh}
    .brand{display:flex;align-items:center;gap:10px;padding:22px 20px;border-bottom:1px solid var(--border)}
    .brand-logo{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg, var(--brand), #7afcff);}
    .brand h1{font-size:18px;margin:0;font-weight:700;letter-spacing:.3px}
    .nav{padding:12px 10px}
    .nav a{display:flex;align-items:center;gap:10px;padding:12px 14px;border-radius:10px;color:var(--muted);margin:6px 8px;font-weight:600}
    .nav a.active,.nav a:hover{background:rgba(0,188,212,.12);color:#cff7ff}
    .nav .sep{height:1px;background:var(--border);margin:14px 10px}
    /* Main */
    .main{display:flex;flex-direction:column;min-width:0}
    .topbar{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--border);position:sticky;top:0;background:rgba(13,17,23,.8);backdrop-filter:saturate(160%) blur(6px);z-index:2}
    .search{flex:1;max-width:520px;display:flex;align-items:center;background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:10px 12px;gap:10px}
    .search input{all:unset;width:100%;color:var(--text)}
    .user-nav{display:flex;align-items:center;gap:10px}
    .btn{appearance:none;border:0;outline:0;background:var(--brand);color:#001015;font-weight:700;border-radius:10px;padding:10px 14px;cursor:pointer}
    .btn:hover{background:var(--brand-2)}
    .btn.secondary{background:#232a34;color:#e6e6e6;border:1px solid var(--border)}
    .btn.secondary:hover{background:#283040}
    .content{padding:22px 22px 40px;display:grid;gap:22px}
    /* Wallet cards */
    .grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
    @media (max-width:900px){.layout{grid-template-columns:1fr}.sidebar{display:none}.grid-2{grid-template-columns:1fr}}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:18px}
    .card h3{margin:0 0 6px;font-size:16px}
    .balance{display:flex;align-items:center;justify-content:space-between}
    .kpi{font-size:28px;font-weight:800}
    .muted{color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    /* Sections */
    .section-head{display:flex;align-items:center;justify-content:space-between;margin-top:6px}
    /* Gallery */
    .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:16px}
    .nft{background:var(--panel);border:1px solid var(--border);border-radius:14px;overflow:hidden}
    .nft img{display:block;width:100%;height:190px;object-fit:cover;background:#0b0f14}
    .nft .info{padding:12px 12px 14px}
    .nft .title{font-weight:700}
    .nft .meta{display:flex;align-items:center;justify-content:space-between;margin-top:8px;color:var(--muted)}
    /* Modals */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:20px;z-index:5}
    .modal.open{display:flex}
    .dialog{width:100%;max-width:520px;background:var(--panel);border:1px solid var(--border);border-radius:16px;overflow:hidden}
    .dialog header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
    .dialog header h4{margin:0;font-size:16px}
    .dialog .body{padding:16px}
    .dialog .foot{padding:14px 16px;border-top:1px solid var(--border);display:flex;gap:10px;justify-content:flex-end}
    .field{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}
    .field input,.field select,.field textarea{background:#0f141b;border:1px solid var(--border);border-radius:10px;color:var(--text);padding:10px}
    .pill-tabs{display:flex;gap:8px;margin-bottom:12px}
    .pill-tabs button{flex:1;padding:10px;border-radius:999px;border:1px solid var(--border);background:#0f141b;color:var(--text);cursor:pointer}
    .pill-tabs button.active{background:rgba(0,188,212,.15);border-color:var(--brand)}
    .copy{background:#0f141b;border:1px dashed var(--border);padding:10px;border-radius:10px;display:flex;align-items:center;justify-content:space-between;gap:10px}
    .tag{display:inline-block;padding:4px 8px;border-radius:999px;background:#0f141b;border:1px solid var(--border);color:var(--muted);font-size:12px}
    .note{font-size:12px;color:var(--muted)}
    .alert{padding:10px 12px;border-radius:10px}
    .alert.success{background:rgba(23,201,100,.1);border:1px solid rgba(23,201,100,.3)}
    .alert.error{background:rgba(243,18,96,.08);border:1px solid rgba(243,18,96,.25)}
  </style>
</head>
<body>
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand">
        <div class="brand-logo"></div>
        <h1>ArtMintX</h1>
      </div>
      <nav class="nav">
        <a href="#" class="active" id="navDashboard">Dashboard</a>
        <a href="#" id="navMyArt">My Artworks</a>
        <a href="#" id="navDiscover">Discover</a>
        <div class="sep"></div>
        <a href="#" id="navWallet">Wallet</a>
        <a href="#" id="navSettings">Settings</a>
      </nav>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="topbar">
        <div class="search">
          <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16a6.471 6.471 0 004.23-1.57l.27.28v.79L20 21.5 21.5 20 15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
          <input id="searchInput" placeholder="Search artworks, users…"/>
        </div>
        <div class="user-nav">
          <button class="btn secondary" id="btnMint">Mint Artwork</button>
          <button class="btn secondary" id="btnFund">Fund Wallet</button>
          <button class="btn" id="btnLogout">Logout</button>
        </div>
      </div>

      <div class="content" id="viewDashboard">
        <!-- Wallet row -->
        <div class="grid-2">
          <div class="card">
            <div class="balance">
              <div>
                <h3>BTC Wallet</h3>
                <div class="muted">Balance (USD equivalent)</div>
              </div>
              <div class="kpi" id="btcUsd">$0.00</div>
            </div>
            <div class="row" style="margin-top:12px">
              <span class="tag" id="btcLast">updated now</span>
            </div>
          </div>
          <div class="card">
            <div class="balance">
              <div>
                <h3>SOL Wallet</h3>
                <div class="muted">Balance (USD equivalent)</div>
              </div>
              <div class="kpi" id="solUsd">$0.00</div>
            </div>
            <div class="row" style="margin-top:12px">
              <span class="tag" id="solLast">updated now</span>
            </div>
          </div>
        </div>

        <!-- Marketplace sampler -->
        <div class="section-head">
          <h2 style="margin:6px 0">Discover</h2>
          <div class="row">
            <button class="btn secondary" id="btnGoDiscover">Explore</button>
          </div>
        </div>
        <div class="gallery" id="discoverGallery">
          <div class="nft">
            <img src="https://images.unsplash.com/photo-1549880338-65ddcdfd017b?q=80&w=800&auto=format&fit=crop" alt="Neon City">
            <div class="info">
              <div class="title">Neon City</div>
              <div class="meta"><span>1.2 SOL</span><span>#city</span></div>
            </div>
          </div>
          <div class="nft">
            <img src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=800&auto=format&fit=crop" alt="Spectrum">
            <div class="info">
              <div class="title">Spectrum</div>
              <div class="meta"><span>0.02 BTC</span><span>#abstract</span></div>
            </div>
          </div>
          <div class="nft">
            <img src="https://images.unsplash.com/photo-1495567720989-cebdbdd97913?q=80&w=800&auto=format&fit=crop" alt="Mirage">
            <div class="info">
              <div class="title">Mirage</div>
              <div class="meta"><span>0.9 SOL</span><span>#surreal</span></div>
            </div>
          </div>
        </div>

        <!-- My Artworks -->
        <div class="section-head" style="margin-top:10px">
          <h2 style="margin:6px 0">My Artworks</h2>
          <div class="row">
            <button class="btn secondary" id="btnMint2">Mint Artwork</button>
          </div>
        </div>
        <div class="gallery" id="myGallery"></div>
      </div>

      <!-- Placeholder views (simple) -->
      <div class="content" id="viewMyArt" style="display:none">
        <div class="section-head">
          <h2 style="margin:6px 0">My Artworks</h2>
          <div class="row">
            <button class="btn secondary" id="btnMint3">Mint Artwork</button>
          </div>
        </div>
        <div class="gallery" id="myGalleryOnly"></div>
      </div>

      <div class="content" id="viewDiscover" style="display:none">
        <div class="section-head">
          <h2 style="margin:6px 0">Discover</h2>
        </div>
        <div class="gallery" id="discoverOnly"></div>
      </div>

      <div class="content" id="viewWallet" style="display:none">
        <h2 style="margin:6px 0">Wallet</h2>
        <div class="grid-2">
          <div class="card">
            <h3>Your BTC Wallet (USD)</h3>
            <div class="kpi" id="btcUsd2">$0.00</div>
          </div>
          <div class="card">
            <h3>Your SOL Wallet (USD)</h3>
            <div class="kpi" id="solUsd2">$0.00</div>
          </div>
        </div>
        <div class="row" style="margin-top:14px">
          <button class="btn" id="btnFund2">Fund Wallet</button>
        </div>
        <p class="note" style="margin-top:10px">Funds appear after confirmation. If you’ve sent crypto, use “I’ve Paid” in the popup so admin can verify.</p>
      </div>
    </main>
  </div>

  <!-- Fund Wallet Modal -->
  <div class="modal" id="modalFund">
    <div class="dialog">
      <header>
        <h4>Fund Your Wallet</h4>
        <button class="btn secondary" id="closeFund">Close</button>
      </header>
      <div class="body">
        <div class="pill-tabs">
          <button id="tabBTC" class="active">BTC</button>
          <button id="tabSOL">SOL</button>
        </div>

        <div id="btcPane">
          <div class="field">
            <label class="muted">Deposit Address (BTC)</label>
            <div class="copy">
              <span id="btcAddr">bc1qq6tzrya3sn5m3nee6f6vzfa59wprvplkj45ulk</span>
              <button class="btn secondary" id="copyBTC">Copy</button>
            </div>
          </div>
          <div class="alert">
            Send any BTC amount. It will reflect in your on-site BTC wallet once confirmed.
          </div>
        </div>

        <div id="solPane" style="display:none">
          <div class="field">
            <label class="muted">Deposit Address (SOL)</label>
            <div class="copy">
              <span id="solAddr">G2GYyxj4bjzdrxX4BUrgFFiB63e9QvcqbzPMuruRdBu1</span>
              <button class="btn secondary" id="copySOL">Copy</button>
            </div>
          </div>
          <div class="alert">
            Send any SOL amount. It will reflect in your on-site SOL wallet once confirmed.
          </div>
        </div>

        <p class="note">Double-check the network and address before sending. Payments are irreversible.</p>
      </div>
      <div class="foot">
        <button class="btn secondary" id="paidLater">Cancel</button>
        <button class="btn" id="paidConfirm">I’ve Paid</button>
      </div>
    </div>
  </div>

  <!-- Mint Modal (fee first) -->
  <div class="modal" id="modalMint">
    <div class="dialog">
      <header>
        <h4>Mint Artwork — $10 mint fee</h4>
        <button class="btn secondary" id="closeMint">Close</button>
      </header>
      <div class="body">
        <div class="field">
          <label>Choose wallet to pay fee</label>
          <select id="feeWallet">
            <option value="btc">BTC Wallet (USD)</option>
            <option value="sol">SOL Wallet (USD)</option>
          </select>
        </div>
        <div id="mintFeeStatus" class="alert error" style="display:none"></div>
        <p class="note">A fixed $10 fee is required to mint. If your selected wallet balance is below $10, you’ll be asked to fund first.</p>
      </div>
      <div class="foot">
        <button class="btn secondary" id="cancelMint">Cancel</button>
        <button class="btn" id="proceedFee">Pay $10 Fee</button>
      </div>
    </div>
  </div>

  <!-- Upload Modal (unlocked after fee) -->
  <div class="modal" id="modalUpload">
    <div class="dialog">
      <header>
        <h4>Upload Artwork</h4>
        <button class="btn secondary" id="closeUpload">Close</button>
      </header>
      <div class="body">
        <div class="field">
          <label>Artwork Title</label>
          <input type="text" id="artTitle" placeholder="e.g., Neon City #1"/>
        </div>
        <div class="field">
          <label>Price (you set the USD price)</label>
          <input type="number" min="1" id="artPrice" placeholder="e.g., 120"/>
        </div>
        <div class="field">
          <label>Upload Image</label>
          <input type="file" id="artFile" accept="image/*"/>
        </div>
        <div id="uploadHint" class="note">After saving, your artwork appears under “My Artworks”.</div>
      </div>
      <div class="foot">
        <button class="btn secondary" id="cancelUpload">Cancel</button>
        <button class="btn" id="saveArtwork">Save Artwork</button>
      </div>
    </div>
  </div>

  <script>
    /* ------------------------------
       Simple state using localStorage
       Keys: amx_btc_usd, amx_sol_usd, amx_artworks
    ------------------------------- */
    const $ = (q)=>document.querySelector(q);
    const $$ = (q)=>document.querySelectorAll(q);

    function lsGet(key, def){
      try{const v = localStorage.getItem(key); return v? JSON.parse(v) : def;}
      catch(_){return def}
    }
    function lsSet(key, val){
      localStorage.setItem(key, JSON.stringify(val));
    }

    // Initialize balances if missing
    let btcUsd = lsGet('amx_btc_usd', 0);
    let solUsd = lsGet('amx_sol_usd', 0);
    let artworks = lsGet('amx_artworks', []); // [{title, priceUsd, dataUrl}]

    function fmtUsd(n){ return '$' + Number(n).toFixed(2); }

    function renderBalances(){
      $('#btcUsd').textContent = fmtUsd(btcUsd);
      $('#solUsd').textContent = fmtUsd(solUsd);
      $('#btcUsd2').textContent = fmtUsd(btcUsd);
      $('#solUsd2').textContent = fmtUsd(solUsd);
      $('#btcLast').textContent = 'updated ' + new Date().toLocaleTimeString();
      $('#solLast').textContent = 'updated ' + new Date().toLocaleTimeString();
    }

    function renderMyArt(targetIds=['myGallery','myGalleryOnly']){
      for(const id of targetIds){
        const node = document.getElementById(id);
        if(!node) continue;
        node.innerHTML = '';
        if(artworks.length === 0){
          const empty = document.createElement('div');
          empty.className='alert';
          empty.textContent = 'No artworks yet. Mint your first piece!';
          node.appendChild(empty);
        } else {
          artworks.forEach(a=>{
            const card = document.createElement('div');
            card.className='nft';
            const img = document.createElement('img');
            img.src = a.dataUrl;
            img.alt = a.title;
            const info = document.createElement('div'); info.className='info';
            const ttl = document.createElement('div'); ttl.className='title'; ttl.textContent = a.title;
            const meta = document.createElement('div'); meta.className='meta';
            meta.innerHTML = `<span>${fmtUsd(a.priceUsd)}</span><span>#minted</span>`;
            info.appendChild(ttl); info.appendChild(meta);
            card.appendChild(img); card.appendChild(info);
            node.appendChild(card);
          });
        }
      }
    }

    function saveState(){
      lsSet('amx_btc_usd', btcUsd);
      lsSet('amx_sol_usd', solUsd);
      lsSet('amx_artworks', artworks);
      renderBalances();
      renderMyArt();
    }

    // View switching
    function showView(id){
      ['viewDashboard','viewMyArt','viewDiscover','viewWallet'].forEach(v=>{
        document.getElementById(v).style.display = (v===id)? 'block':'none';
      });
      // Simple discover duplication (for the dedicated view)
      if(id==='viewDiscover'){
        const src = document.getElementById('discoverGallery').innerHTML;
        document.getElementById('discoverOnly').innerHTML = src;
      }
      if(id==='viewMyArt'){
        renderMyArt(['myGalleryOnly']);
      }
    }

    // --- Fund Wallet Modal ---
    const modalFund = $('#modalFund');
    $('#btnFund').onclick = $('#btnFund2').onclick = ()=> modalFund.classList.add('open');
    $('#closeFund').onclick = $('#paidLater').onclick = ()=> modalFund.classList.remove('open');
    // Tabs
    const tabBTC = $('#tabBTC'), tabSOL = $('#tabSOL');
    const btcPane = $('#btcPane'), solPane = $('#solPane');
    tabBTC.onclick = ()=>{ tabBTC.classList.add('active'); tabSOL.classList.remove('active'); btcPane.style.display='block'; solPane.style.display='none'; };
    tabSOL.onclick = ()=>{ tabSOL.classList.add('active'); tabBTC.classList.remove('active'); solPane.style.display='block'; btcPane.style.display='none'; };
    // Copy
    $('#copyBTC').onclick = async ()=>{
      await navigator.clipboard.writeText($('#btcAddr').textContent.trim());
      toast('BTC address copied');
    };
    $('#copySOL').onclick = async ()=>{
      await navigator.clipboard.writeText($('#solAddr').textContent.trim());
      toast('SOL address copied');
    };
    $('#paidConfirm').onclick = ()=>{
      // No self-credit here. User notifies paid; admin will credit later.
      modalFund.classList.remove('open');
      toast('Payment noted. Balance will update after confirmation.');
    };

    // --- Mint flow (fee first, then upload) ---
    const modalMint = $('#modalMint');
    const modalUpload = $('#modalUpload');

    const openMint = ()=> modalMint.classList.add('open');
    const closeMint = ()=> modalMint.classList.remove('open');
    const openUpload = ()=> modalUpload.classList.add('open');
    const closeUpload = ()=> modalUpload.classList.remove('open');

    $('#btnMint').onclick = $('#btnMint2').onclick = $('#btnMint3').onclick = openMint;
    $('#closeMint').onclick = $('#cancelMint').onclick = closeMint;

    $('#proceedFee').onclick = ()=>{
      const w = $('#feeWallet').value; // 'btc' | 'sol'
      const fee = 10; // USD fixed fee
      if(w==='btc'){
        if(btcUsd >= fee){
          btcUsd -= fee; saveState();
          toast('Mint fee paid from BTC wallet');
          closeMint(); openUpload();
        }else{
          showInsufficient('BTC');
        }
      }else{
        if(solUsd >= fee){
          solUsd -= fee; saveState();
          toast('Mint fee paid from SOL wallet');
          closeMint(); openUpload();
        }else{
          showInsufficient('SOL');
        }
      }
    };

    function showInsufficient(which){
      const s = $('#mintFeeStatus');
      s.className = 'alert error';
      s.style.display = 'block';
      s.textContent = `Insufficient ${which} wallet balance. Please fund your wallet.`;
      // Also open fund modal for convenience
      setTimeout(()=>{ modalFund.classList.add('open'); }, 400);
    }

    // Upload flow (after fee)
    $('#closeUpload').onclick = $('#cancelUpload').onclick = closeUpload;
    $('#saveArtwork').onclick = async ()=>{
      const title = $('#artTitle').value.trim();
      const price = Number($('#artPrice').value);
      const file = $('#artFile').files[0];

      if(!title || !price || !file){ toast('Please fill all fields and select an image.', true); return; }

      // Convert image to data URL for storage/display
      const dataUrl = await fileToDataURL(file);
      artworks.push({ title, priceUsd: price, dataUrl });
      saveState();
      // Reset form
      $('#artTitle').value=''; $('#artPrice').value=''; $('#artFile').value='';
      closeUpload();
      toast('Artwork saved and listed in My Artworks.');
      // Ensure My Artworks section updates
      renderMyArt(['myGallery','myGalleryOnly']);
    };

    function fileToDataURL(file){
      return new Promise((res,rej)=>{
        const r = new FileReader();
        r.onload = ()=>res(r.result);
        r.onerror = rej;
        r.readAsDataURL(file);
      });
    }

    // Simple toast
    function toast(msg, isError=false){
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.position='fixed'; t.style.bottom='24px'; t.style.right='24px';
      t.style.background = isError? 'rgba(243,18,96,.9)' : 'rgba(0,188,212,.96)';
      t.style.color = isError? '#fff' : '#001015';
      t.style.padding='10px 14px'; t.style.borderRadius='10px'; t.style.fontWeight='700';
      t.style.boxShadow='0 8px 20px rgba(0,0,0,.25)'; t.style.zIndex='10';
      document.body.appendChild(t);
      setTimeout(()=>{ t.remove(); }, 2500);
    }

    // Top nav
    $('#btnLogout').onclick = ()=>{
      // In a real app, you’d clear auth & redirect. Here, just confirm.
      toast('Logged out'); setTimeout(()=>location.href='index.html', 800);
    };
    $('#btnGoDiscover').onclick = ()=> showView('viewDiscover');
    $('#navDashboard').onclick = (e)=>{e.preventDefault(); showView('viewDashboard');};
    $('#navMyArt').onclick = (e)=>{e.preventDefault(); showView('viewMyArt');};
    $('#navDiscover').onclick = (e)=>{e.preventDefault(); showView('viewDiscover');};
    $('#navWallet').onclick = (e)=>{e.preventDefault(); showView('viewWallet');};
    $('#navSettings').onclick = (e)=>{e.preventDefault(); alert('Settings coming soon');};

    // Search (basic filter in Discover tiles)
    $('#searchInput').addEventListener('input', (e)=>{
      const q = e.target.value.toLowerCase();
      for(const card of $$('#discoverGallery .nft')){
        const title = card.querySelector('.title')?.textContent.toLowerCase() || '';
        card.style.display = title.includes(q)? '' : 'none';
      }
    });

    // Initial render
    renderBalances();
    renderMyArt(['myGallery','myGalleryOnly']);
  </script>
</body>
</html>
